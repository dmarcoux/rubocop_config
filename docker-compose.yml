version: '3.4'
services:
  web_app:
    build:
      args:
        USER_ID: 1000
      context: .
    # CHANGEME: Use database if needed (SQLite doesn't need this since it's installed directly in the container)
    # depends_on:
    #   - postgres
    environment:
      - RAILS_PORT=3000 # Do not forget to change ports below when changing this
      - REDIS_HOST=redis # Name of the redis service
      - REDIS_PORT=6379 # Do not forget to change ports in redis service when changing this
    ports:
      - '80:80' # Do not forget to change RAILS_PORT above when changing this
    volumes:
      - .:/app # Same as $WORKDIR from Dockerfile
      - gems:/gems # Cache gems from 'bundler' commands (install, update, etc...) in gems volume

  # CHANGEME: Uncomment service below or remove comment block
  # Other services depend on this. It shouldn't be run by itself
  # postgres:
  #   environment:
  #     - POSTGRES_USER=postgres_user
  #     - POSTGRES_PASSWORD=postgres_password
  #     - POSTGRES_DB=database_dev
  #   image: postgres:10.2
  #   ports:
  #     - '5432:5432'

  # CHANGEME: Uncomment service below or remove comment block
  # Other services depend on this. It shouldn't be run by itself
  # redis:
  #   image: redis:3.2.11
  #   ports:
  #     - '6379:6379' # Do not forget to change REDIS_PORT when changing this

volumes:
  # Cache gems from 'bundler' commands (install, update, etc...)
  gems:
